generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Session {
  id        String   @id
  sid       String   @unique
  data      String
  expiresAt DateTime
}

model User {
  id           String        @id @default(uuid()) @db.Uuid
  email        String        @unique
  name         String?
  password     String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime?     @updatedAt
  alapadatokId String?       @db.Uuid
  permissions  Int           @default(0)
  logs         Log[]
  tableAccess  TableAccess[]
  alapadatok   Alapadatok?   @relation("AlapadatokUsers", fields: [alapadatokId], references: [id])

  @@map("users")
}

model TableList {
  id        String    @id @default(uuid()) @db.Uuid
  name      String    @unique @db.VarChar(100)
  isAvailable Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  access    TableAccess[]

  @@map("table_list")
}

model TableAccess {
  userId    String   @db.Uuid
  tableId   String    @db.Uuid
  access    Int       @default(0)
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt
  user      User?     @relation(fields: [userId], references: [id])
  table     TableList @relation(fields: [tableId], references: [id])

  @@id([userId, tableId])
  @@map("table_access")
}

model Log {
  id            String   @id @default(uuid()) @db.Uuid
  userId        String?  @db.Uuid
  method        String   @db.VarChar(10)
  path          String   @db.VarChar(255)
  statusCode    Int?     @db.SmallInt  
  body          Json?
  query         Json?
  headers       Json?
  ip            String   @db.VarChar(45)
  userAgent     String   @db.VarChar(255)

  duration      Int?     // Request duration in ms
  level         String   @default("INFO") @db.VarChar(10) // INFO, WARN, ERROR
  correlationId String?  @db.VarChar(50) // For tracking related requests
  createdAt     DateTime @default(now())

  user          User?    @relation(fields: [userId], references: [id])


  @@index([createdAt, level])
  @@index([path])
  @@index([userId])

  @@map("logs")
}

model Alapadatok {
  id              String            @id @default(uuid()) @db.Uuid
  iskola_neve     String            @db.VarChar(150)
  intezmeny_tipus String            @db.VarChar(50)
  felvettek_szama Felvettek_Szama[]
  kompetencia     Kompetencia[]
  tanar_letszam   Tanar_Letszam[]
  tanugyiAdatok   Tanugyi_Adatok[]
  alkalmazottakMunkaugy Alkalmazottak_Munkaugy[]
  tanulo_letszam  Tanulo_Letszam[]
  egyOktatoraJutoTanulo EgyOktatoraJutoTanulo[]
  szakkepzesiStatisztika SzakkepzesiStatisztika[]
  versenyek       versenyek[]
  alapadatok_szakirany Alapadatok_Szakirany[]

  users           User[]            @relation("AlapadatokUsers")
}

model Szakirany {
  id              String            @id @default(uuid()) @db.Uuid
  nev             String            @unique @db.VarChar(75)
  felvettek_szama Felvettek_Szama[]
  tanulo_letszam  Tanulo_Letszam[]
  szakkepzesiStatisztika SzakkepzesiStatisztika[]

  alapadatok_szakirany Alapadatok_Szakirany[]
  szakma          Szakirany_Szakma[]
}

model Szakma {
  id              String            @id @default(uuid()) @db.Uuid
  nev             String            @unique @db.VarChar(75)
  felvettek_szama Felvettek_Szama[]
  tanulo_letszam  Tanulo_Letszam[]
  szakkepzesiStatisztika SzakkepzesiStatisztika[]

  alapadatok_szakma Szakirany_Szakma[]
}

model Szakirany_Szakma {
  szakirany_id String @db.Uuid
  szakma_id     String @db.Uuid

  szakma        Szakma     @relation(fields: [szakma_id], references: [id])
  szakirany     Szakirany  @relation(fields: [szakirany_id], references: [id])

  @@id([szakirany_id, szakma_id])
}

model Alapadatok_Szakirany {
  alapadatok_id String @db.Uuid
  szakirany_id  String @db.Uuid

  alapadatok    Alapadatok @relation(fields: [alapadatok_id], references: [id])
  szakirany     Szakirany  @relation(fields: [szakirany_id], references: [id])

  @@id([alapadatok_id, szakirany_id])
}

model Tanulo_Letszam {
  id            String     @id @default(uuid()) @db.Uuid
  alapadatok_id String     @db.Uuid
  tanev_kezdete Int        @db.SmallInt
  jogv_tipus    Int        @db.SmallInt
  letszam       Int        @db.SmallInt
  szakirany_id  String     @db.Uuid
  szakma_id     String     @db.Uuid
  createAt      DateTime   @default(now())
  createBy      String?
  updatedAt     DateTime?  @updatedAt
  updatedBy     String?
  alapadatok    Alapadatok @relation(fields: [alapadatok_id], references: [id])
  szakirany     Szakirany  @relation(fields: [szakirany_id], references: [id])
  szakma        Szakma     @relation(fields: [szakma_id], references: [id])
}

model Tanar_Letszam {
  id            String     @id @default(uuid()) @db.Uuid
  alapadatok_id String     @db.Uuid
  tanev_kezdete Int        @db.SmallInt
  letszam       Int        @db.SmallInt
  createAt      DateTime   @default(now())
  createBy      String?
  updatedAt     DateTime?  @updatedAt
  updatedBy     String?
  alapadatok    Alapadatok @relation(fields: [alapadatok_id], references: [id])
}

model Felvettek_Szama {
  id                 String     @id @default(uuid()) @db.Uuid
  alapadatok_id      String     @db.Uuid
  tanev_kezdete      Int        @db.SmallInt
  szakma_id          String     @db.Uuid
  jelentkezo_letszam Int        @db.SmallInt
  felveheto_letszam  Int        @db.SmallInt
  felvett_letszam    Int        @db.SmallInt
  createAt           DateTime   @default(now())
  createBy           String?
  updatedAt          DateTime?  @updatedAt
  updatedBy          String?
  szakiranyId        String?    @db.Uuid
  alapadatok         Alapadatok @relation(fields: [alapadatok_id], references: [id])
  szakirany          Szakirany? @relation(fields: [szakiranyId], references: [id])
  szakma             Szakma     @relation(fields: [szakma_id], references: [id])
}

model Kompetencia {
  id            String     @id @default(uuid()) @db.Uuid
  tanev_kezdete Int        @default(0) @db.SmallInt
  mat_orsz_p    String
  szoveg_orsz_p String
  mat_int_p     String
  szoveg_int_p  String
  kepzes_forma  String
  alapadatok_id String     @db.Uuid
  createAt      DateTime   @default(now())
  createBy      String?
  updatedAt     DateTime?  @updatedAt
  updatedBy     String?
  alapadatok    Alapadatok @relation(fields: [alapadatok_id], references: [id])
}

model EgyOktatoraJutoTanulo {
  id            String     @id @default(uuid()) @db.Uuid
  alapadatok_id String     @db.Uuid
  tanev_kezdete Int        @default(0) @db.SmallInt
  letszam       Int        @default(0) @db.SmallInt
  createAt      DateTime   @default(now())
  createBy      String?
  updatedAt     DateTime?  @updatedAt
  updatedBy     String?
  alapadatok    Alapadatok @relation(fields: [alapadatok_id], references: [id])
}

/*
Excel table models
*/

model Tanugyi_Adatok {
  id                                                              String     @id @default(uuid()) @db.Uuid
  elotag                                                          String?
  vezeteknev                                                      String?
  utonev                                                          String?
  oktatasiAzonositoja                                             String?
  osztaly                                                         String?
  szuletesiDatuma                                                 String?
  anyjaSzuletesiDatuma                                            String?
  tanterv                                                         String?
  naploSorszam                                                    String?
  beiras_naplo_sorszam                                            String?
  felvetel_taneve                                                 String?
  torzslapszam                                                    String?
  tanulo_jogviszonya                                              String?
  jogviszony_kezdete                                              String?
  jogviszony_megszunesenek_varhato_datuma                         String?
  jogviszonyátSzunetelteto                                       String?
  tankotelezettsegetTeljesito                                     String?
  tankotelezettségVege                                           String?
  bejaro                                                          String?
  Szakmai_gyakorlaton_tartozkodik                                 String?
  Egyeni_munkarend                                                String?
  Egyeni_munkarend_oka                                            String?
  Egyeni_munkarend_kezdete                                        String?
  Egyeni_munkarend_vege                                           String?
  Vendegtanulo                                                    String?
  tandijat_fizeto                                                 String?
  teritesi_dijat_fizeto                                           String?
  tanuloszerzodeses                                               String?
  polgari_szerzodeses                                             String?
  iskolai_sportkorben_reszt_vevo_tanulo                           String?
  evfolyamismetlo                                                 String?
  elozo_intezmeny                                                 String?
  osztaly1                                                        String?
  evfolyam                                                        String?
  bizonyitvany_sorszama                                           String?
  okleveles_technikus_képzes                                     String?
  uj_Szkt_agazat_tipusa                                           String?
  uj_szkt_szakma_tipusa                                           String?
  uj_szkt_szakmairany_tipusa                                      String?
  nkt_tanulmanyi_terulet                                          String?
  nkt_szakkepesites                                               String?
  nkt_szakirany                                                   String?
  agazat_uj_szkt_reszszakmahoz                                    String?
  szakma_reszszakmahoz                                            String?
  reszszakma                                                      String?
  agazat_tanulmanyi_terulet                                       String?
  szakmai_kepzes                                                  String?
  agazati_alapoktatas_megnevezese                                 String?
  agazati_alapvizsga_eredmeny                                     String?
  agazati_alapvizsga_teljesitesenek_datuma                        String?
  agazati_alapvizsga_eredmenye                                    String?
  agazati_alapvizsga_eredmenye_percent                            String?
  szakkepzesi_munkaszerzodessel                                   String?
  Dualis_kepzohely_neve                                           String?
  Dualis_kepzohely_adoszama                                       String?
  kiemelten_tehetseges                                            String?
  szamitogepet_tanulasi_oktatasi_celra_hasznal                    String?
  szaboky_adolf_szakkepzesi_osztondijban_reszesul                 String?
  egesz_napos_iskolai_oktatasban_reszesul                         String?
  nyelvi_elokeszito                                               String?
  ket_tanitasi_nyelvu                                             String?
  NemzetisegiNevelesOktatas                                       String?
  NemzetisegiNevelesOktatásFajtaja                               String?
  nemzetisegiNyelv                                                String?
  nemzetisegNyelvenFolyoSzakmaiOktatas                            String?
  sportosztaly                                                    String?
  aranyjanostehetseggondozoprogram                                String?
  arany_janos_kollegiumi_program                                  String?
  munkarend                                                       String?
  alapadatok_id                                                   String     @db.Uuid
  createAt                                                        DateTime   @default(now())
  createBy                                                        String
  updatedAt                                                       DateTime?  @updatedAt
  updatedBy                                                       String?
  a_9_evfolyamosok_kozul_a_8_evfolyamot_az_elozo_tanevben_vegezte String?
  tanev_kezdete                                                   Int        @default(0) @db.SmallInt
  alapadatok                                                      Alapadatok @relation(fields: [alapadatok_id], references: [id])
}

model Alkalmazottak_Munkaugy {
  id            String     @id @default(uuid()) @db.Uuid
  Elotag       String?
  Vezeteknev   String?
  Utonev       String?
  AlkalmazottTeljesNeve String?
  PedagogusOkatatasiAzonosito String?
  TanevKezdete Int @default(0) @db.SmallInt
  PedagogusFokozat String?
  Munkakor String?
  FoglalkoztatasiJogviszony String?
  UtazoGyogypedagogus String?
  FoglalkoztatasTipusa String?
  VezetoiOraszamOka String?
  KotelezoOraszama Int @default(0) @db.SmallInt
  Oraszam Decimal @default(0.00) @db.Decimal(2, 2)
  FeladattalTerheltOraszam Decimal @default(0.00) @db.Decimal(2, 2)
  PedagogusHetiOraszama Decimal @default(0.00) @db.Decimal(2, 2)
  CsokkentettMunkaidos String?
  AlkalmazasKezdete DateTime @db.Date @default(now())
  AlkalmazasVege DateTime @db.Date @default(now())
  TartosanTavollevo String?
  Nyugdijas String?
  BetoltetlenAllashely String?
  KulsoAlkalmazott String?
  Foallasu String?
  SzabadAllashely String?
  SzakertoiVagyVizsgaelnokiTevekenysegu String?
  Szakvizsga String?
  SzakertoSzaktanacsado String?
  SZTSZSzam String?
  FeladatellatasiHely String?
  Kepesites String?
  InternetetOktatasiCelraHsznal String?
  InformatikaiKepesitesselIsmeretekkelRendelkezik String?
  IKTEszkozoketATanorajaLegalabb40abanHasznalja String?
  ApaczaiMentor String?

  alapadatok_id String @db.Uuid
  
  alapadatok    Alapadatok @relation(fields: [alapadatok_id], references: [id])

  @@map("alkalmazottak_munkaugy")
}

model SzakkepzesiStatisztika {
  id            String     @id @default(uuid()) @db.Uuid
  alapadatok_id String     @db.Uuid
  tanev_kezdete Int        @db.SmallInt
  szakirany_id  String     @db.Uuid
  szakma_id     String     @db.Uuid
  statisztika_tipus String @db.VarChar(50) // "munkaszerz_arany", "munkaszerz_tanulok", "szakiranyu_tanulok"
  letszam       Int?       @db.Integer // Can store both percentages and counts
  createAt      DateTime   @default(now())
  createBy      String?
  updatedAt     DateTime?  @updatedAt
  updatedBy     String?
  alapadatok    Alapadatok @relation(fields: [alapadatok_id], references: [id])
  szakirany     Szakirany  @relation(fields: [szakirany_id], references: [id])
  szakma        Szakma     @relation(fields: [szakma_id], references: [id])

  @@map("szakkepzesi_statisztika")
}

model VesenyKategoria {
  id          String     @id @default(uuid()) @db.Uuid
  nev          String     @db.VarChar(100) @unique

  createAt     DateTime   @default(now())
  createBy     String?
  updatedAt    DateTime?  @updatedAt
  updatedBy    String?

  versenyNevek VesenyNevek[]

  @@map("veseny_kategoria")
}

model VesenyNevek {
  id          String     @id @default(uuid()) @db.Uuid
  nev          String     @db.VarChar(100) @unique
  kategoria_id String     @db.Uuid

  createAt     DateTime   @default(now())
  createBy     String?
  updatedAt    DateTime?  @updatedAt
  updatedBy    String?

  kategoria    VesenyKategoria @relation(fields: [kategoria_id], references: [id])
  versenyek    versenyek[]

  @@map("veseny_nevek")
}

model versenyek {
  id           String     @id @default(uuid()) @db.Uuid
  helyezett_1       Int    @db.Integer
  helyezett_1_3     Int    @db.Integer
  dontobeJutott     Int    @db.Integer
  nevezettekSzama   Int    @db.Integer
  tanev_kezdete Int        @db.SmallInt

  alapadatok_id String     @db.Uuid
  versenyNev_id String     @db.Uuid

  createAt      DateTime   @default(now())
  createBy      String?
  updatedAt     DateTime?  @updatedAt
  updatedBy     String?
  
  alapadatok    Alapadatok @relation(fields: [alapadatok_id], references: [id])
  versenyNev    VesenyNevek @relation(fields: [versenyNev_id], references: [id])

  @@map("versenyek")
}